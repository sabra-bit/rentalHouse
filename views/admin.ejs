<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>منزل للايجار</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
  <style>
    /* Optional styles for the suggestion list */
    .autocomplete-suggestions {
        margin-top: auto;
      position: absolute;
      z-index: 10;
      background-color: #4e4949;
      border: 0.5px solid #3d3c3c;
      width: 150px;
      cursor: pointer;

    }

    body {
			background-color: #f2f2f2;
            background-image:  url("https://images.pexels.com/photos/101808/pexels-photo-101808.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1");
			background-repeat: no-repeat;
            background-size: cover;
            font-family: Arial, sans-serif;
		}
		
		h2 {
			text-align: center;
			margin-bottom: 20px;
		}
		label {
			display: block;
			font-weight: bold;
			margin-bottom: 5px;
		}
        input , label , span , textarea{
            margin-bottom: 20px;
        }
		input[type="email"], input[type="password"] {
			
			
			margin-bottom: 20px;
			border: 1px solid #ccc;
			border-radius: 4px;
			box-sizing: border-box;
			font-size: 16px;
		}
		input[type="submit"] {
			background-color: #333;
			color: #fff;
			border: none;
			padding: 10px 20px;
			border-radius: 4px;
			cursor: pointer;
			font-size: 16px;
		}
		input[type="submit"]:hover {
			background-color: #666;
		}

		/* Media Queries for Responsive Design */

		@media screen and (max-width: 480px) {
			.container {
				
				padding: 10px;
			}
			input[type="submit"] {
				font-size: 14px;
			}
		}
		.add-btn {
			display: inline-block;
			background-color: #27ae60;
			color: #fff;
			border: none;
			padding: 8px 16px;
			border-radius: 4px;
			text-decoration: none;
		  }
		  
		  .add-btn:hover {
			background-color: #219d54;
		  }

          a:link, a:visited {
            
			
			cursor: pointer;
			font-size: 16px;
}

a:hover, a:active {
  background-color: rgb(196, 184, 184);
}
footer {
  position: relative; /* Make footer absolute positioned */
  bottom: 0; /* Position footer at the bottom */
  left: 0; /* Align footer to the left */
  width: 100%; /* Set footer width to 100% */
  height: 10vh; /* Set footer height (optional) */

}

html, body {
  direction: rtl;
}

  </style>
</head>
<body>

  <header class="bg-dark py-3">
    <div class="container d-flex justify-content-between align-items-center">
      <div>
     

      </div>
      <nav class="d-flex align-items-center">
        <a href="/" class="text-light text-decoration-none px-3">الصفحة الرئيسية</a>
        <a href="#div_id" class="text-light text-decoration-none px-3">من نحن</a>
        <a href="#div_id" class="text-light text-decoration-none px-3">بيانات الاتصال</a>
        <% if (name) { %>
        <a href="/user" class="btn btn-light btn-sm ms-3"><%= name %></a>  
        <a href="/logout" class="btn btn-light btn-sm ms-3">تسجيل الخروج</a>
        <% } else{ %>  
            <a href="/signin" class="btn btn-light btn-sm ms-3">تسجيل الدخول</a>
         <% } %>
      </nav>
    </div>
  </header>

  <main class="container py-5">

    <section class="d-flex flex-column align-items-center mb-5">
      <h1 class="display-4 mb-4">مرحبا</h1>
      <% if (flashMessage) { %>
        <% for (let item of flashMessage) { %>
        <center id ="msg" style=" padding-bottom: 25px;" >  
            
                <button class="add-btn" onclick="deleteMsg()"> <%= item %> <i class="fa fa-check"></i></button>
              
     
        </center> 
        <% } %>   
  <% } %>

  
      <center>
        <div > 
<form action="/admin" method="POST" style=" padding-bottom: 25px;">

    <div class="container text-center">
        <div class="row">
            <div class="col">
    <label for="name">الاسم:</label>
    <input type="text" id="name" name="name" required></div>
    <div class="col">
    <label for="email">اسم المستخدم:</label>
    <input type="email" id="email" name="email" required></div>
    <div class="col">
    <label for="password">كلمه السر:</label>
    <input type="Text" id="password" name="password" required></div>
    <div class="col">
    <label for="role">الصلاحيه:</label>
    <select id="role" name="role" required>
      <option value="">اختر الصلاحيه</option>
      <option value="admin">مدير نظام</option>
      <option value="user">مستخدم</option>
    </select></div>
    <div class="row">
    <div class="col">
    <button type="submit" class="add-btn"><i class="fa fa-plus"></i> انشاء مستخدم</button></div> </div>


</div></div>
  </form>
</div>
    </center>

     
     
    </section>
   
    <section class="d-flex flex-column align-items-center mb-5">
    
        <table class="table table-dark table-striped">
            <thead>
                <tr>
                  
                  <th>الاسم</th>
                  <th>اسم المستخدم</th>
                  <th>كلمه السر</th>
                  <th>الصلاحيه</th>
                  
                 
                  <th>قرار</th>
                </tr>
              </thead>
              <tbody>
                <% for (let item of Data) { %>

              
                <tr >
                  
                  <td ><%=item.name%></td>
                  <td><%=item.username%></td>
                  <td><%=item.password%></td>
                  <td><%=item.roll%></td>
                  
                 
                  
                  <td>
                  
                  <% if (item.id == 1 ) { %>
                  <button  class="edit-btn" onclick="checkAction('edit','<%=item.id%>','<%=item.name%>','<%=item.username%>','<%=item.password%>','<%=item.roll%>')"><i class="fa fa-pencil"></i></button>
                  <%} else{ %> 
                  <button  class="delete-btn" onclick="checkAction('delete','<%=item.id%>','<%=item.name%>','<%=item.username%>','<%=item.password%>','<%=item.roll%>')"><i class="fa fa-trash"></i></button>
                  <button  class="edit-btn" onclick="checkAction('edit','<%=item.id%>','<%=item.name%>','<%=item.username%>','<%=item.password%>','<%=item.roll%>')"><i class="fa fa-pencil"></i></button>
                  
                  <% } %> 
                  </td>
                </tr>
                
                <% } %>   
              </tbody>
        
        
        </table>

    </section>


    <section>

        <center><p class="lead">اعلاناتى</p> </center>
     
    </section>

    
    <% for (let item of addv) { %>
      
        <center>
  
          <div class="card" style="width: 48rem; margin-bottom: 30px;">
              <div class="card-body">
                <h5 class="card-title"><%= item['name'] %></h5>
                <h6 class="card-subtitle mb-2 text-muted"><%= item['username'] %></h6>
                <img src='http://127.0.0.1:3000/download/<%= item['id'] %>' class="card-img-top" alt="..." width="300" height="400">
                <p class="card-text"><%= item['Description'] %></p>
                
                
                <div class="row">
                  <div class="col-sm">
                    <a  >سعر:<%= item['size'] %></a>
                  </div>
                  <div class="col-sm">
                    <a  >عدد الغرف:<%= item['room'] %></a>  
                  </div>
                </div>

                <div class="row">
                  <div class="col-sm">
                    <a  class="card-link">الهاتف:<%= item['phone'] %></a>
                  </div>
                  <div class="col-sm">
                    <a  class="card-link">السعر:<%= item['price'] %></a>  
                  </div>
                </div>

                <div class="row">
                    <a  class="card-link">الموقع:<%= item['Location'] %></a> 
                </div>
                

              <a href ="http://127.0.0.1:3000/deleteAds/<%= item['id'] %>"  class="btn btn-danger">حذف</a>


              </div>
            </div>
      
          </center>
        <% } %> 

    </section>
   
  </main>

  <footer class="bg-dark text-light text-center py-3" id ="div_id">
    <p>Copyright &copy;  موقع الايجار 2024  01234567890</p>
  </footer>
 

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


  <script>

    function  checkAction (action,id,name,email,password,role){


        Swal.fire({
                title: "Do you want to "+action+" that user ?",
                showDenyButton: false,
                showCancelButton: true,
                confirmButtonText: ""+action
                
                }).then((result) => {
                /* Read more about isConfirmed, isDenied below */
                if (result.isConfirmed) {
                    if(action=='delete'){
                    editeDeleteUser(action,id,name,email,password,role)
                    }else{
                        Edit(action,id,name,email,password,role);
                    }
                } else if (result.isDenied) {
                    Swal.fire("Changes are not saved", "", "info");
                }
                });

    }

    function editeDeleteUser(action,id,name,email,password,role) {
        const data = JSON.stringify({
          'ActionType':action,
          'userId':id,
          'name':name,
          'email':email,
          'password':password,
          'role':role
        })
        const xhr = new XMLHttpRequest()
        xhr.withCredentials = false;
        xhr.addEventListener('readystatechange', function() {
          if (this.readyState === this.DONE) {
              console.log(xhr.responseText);
             location.reload();
          }
        });
        xhr.open('POST', '/editDeleteUser', true) ;
        xhr.setRequestHeader('content-type', 'application/json;charset=UTF-8')
        xhr.send(data);
      }   
      
   
      
   async   function Edit(action,id,name,email,password,role){
        
                    const { value: formValues } = await Swal.fire({
            title: "Multiple inputs",
            html: `
                <input id="swal-input1" placeholder="123-45-678" class="swal2-input">
                
            `,
            focusConfirm: false,
            preConfirm: () => {
                return document.getElementById("swal-input1").value;
            }
            });
            if (formValues) {
                console.log(formValues);
                editeDeleteUser(action,id,name,email,formValues,role);
           
            }
        
        
        
    }


    function deleteMsg(){
  document.getElementById('msg').remove();
}
  </script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://common.olemiss.edu/_js/sweet-alert/sweet-alert.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://common.olemiss.edu/_js/sweet-alert/sweet-alert.css">
</body>
</html>
